name: è‡ªåŠ¨æŠ“å–æ–°é—»

on:
  schedule:
    - cron: '0 */1 * * *'
  workflow_dispatch:

# ğŸ‘‡ğŸ‘‡ğŸ‘‡ æ ¸å¿ƒä¿®æ”¹ï¼šæŠŠæƒé™æ”¾åœ¨æœ€é¡¶å±‚ï¼Œç¡®ä¿ç»å¯¹ç”Ÿæ•ˆ
permissions:
  contents: write

jobs:
  build:
    runs-on: ubuntu-latest
    
    steps:
    - name: 1. ä¸‹è½½ä»£ç 
      uses: actions/checkout@v3
      
    - name: 2. å®‰è£… Python
      uses: actions/setup-python@v4
      with:
        python-version: '3.9'
        
    - name: 3. å®‰è£…ä¾èµ– (å¼ºåˆ¶å®‰è£… requests)
      run: |
        pip install requests
        
    - name: 4. è¿è¡ŒæŠ“å–è„šæœ¬
      run: |
        # æ‰“å°å½“å‰ç›®å½•ï¼Œç¡®ä¿æ²¡æ‰¾é”™ä½ç½®
        pwd
        ls -R backend/
        # è¿è¡Œè„šæœ¬
        python backend/fetch_news.py
      
    - name: 5. æäº¤å¹¶æ¨é€
      run: |
        git config --local user.email "action@github.com"
        git config --local user.name "GitHub Action"
        git add data.json
        # å¦‚æœæœ‰å˜åŠ¨æ‰æäº¤ï¼Œæ²¡å˜åŠ¨è¾“å‡ºæç¤º
        git commit -m "Auto update news" || echo "âš ï¸ æš‚æ— æ–°å†…å®¹ï¼Œæ— éœ€æäº¤"
        git push
