<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ–°é—»çƒ­ç‚¹</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Noto+Sans+SC:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            /* æµ…è‰²æ¨¡å¼ - è«å…°è¿ªè‰²ç³» */
            --bg-primary: #f7f5f2;
            --bg-secondary: #ffffff;
            --bg-card: #ffffff;
            --text-primary: #2d2a26;
            --text-secondary: #6b6560;
            --text-tertiary: #9a9590;
            --border: #e8e4e0;
            --shadow: rgba(0,0,0,0.04);
            
            /* åˆ†ç±»é¢œè‰² - æŸ”å’Œè«å…°è¿ª */
            --color-shanghai: #c9b8a8;
            --color-world: #a8b5c9;
            --color-ai: #c9a8c2;
            --color-stocks: #a8c9b0;
            --color-policy: #c9c2a8;
            
            /* å¼ºè°ƒè‰² */
            --accent: #8b7355;
            --accent-hover: #6d5a42;
        }
        
        [data-theme="dark"] {
            /* æ·±è‰²æ¨¡å¼ - æš–ç°è°ƒ */
            --bg-primary: #1a1918;
            --bg-secondary: #242322;
            --bg-card: #2d2c2a;
            --text-primary: #f5f3f0;
            --text-secondary: #b8b4af;
            --text-tertiary: #8a8680;
            --border: #3d3c3a;
            --shadow: rgba(0,0,0,0.2);
            
            --color-shanghai: #8b7355;
            --color-world: #5a6b8a;
            --color-ai: #8a5a7a;
            --color-stocks: #5a8a6a;
            --color-policy: #8a825a;
            
            --accent: #c9b8a8;
            --accent-hover: #d4c4b5;
        }
        
        * { 
            font-family: 'Inter', 'Noto Sans SC', -apple-system, BlinkMacSystemFont, sans-serif;
            transition: background-color 0.3s ease, color 0.3s ease;
        }
        
        body {
            background: var(--bg-primary);
            min-height: 100vh;
            color: var(--text-primary);
        }
        
        /* å¡ç‰‡æ ·å¼ - æ›´ç´§å‡‘ */
        .xhs-card {
            background: var(--bg-card);
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 1px 8px var(--shadow);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            cursor: pointer;
            border: 1px solid var(--border);
        }
        
        .xhs-card:hover {
            transform: translateY(-4px) scale(1.01);
            box-shadow: 0 8px 24px var(--shadow);
        }
        
        @media (min-width: 768px) {
            .xhs-card {
                border-radius: 16px;
                box-shadow: 0 2px 12px var(--shadow);
            }
            
            .xhs-card:hover {
                transform: translateY(-6px) scale(1.01);
                box-shadow: 0 12px 32px var(--shadow);
            }
        }
        
        /* å›¾ç‰‡åŒºåŸŸ - æ›´ç´§å‡‘ */
        .card-image {
            width: 100%;
            aspect-ratio: 1/1;
            position: relative;
            overflow: hidden;
            background: var(--bg-primary);
        }
        
        @media (min-width: 768px) {
            .card-image {
                aspect-ratio: 4/5;
            }
        }
        
        .card-image img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            transition: transform 0.4s ease;
            display: block;
            position: relative;
            z-index: 1;
        }
        
        .xhs-card:hover .card-image img {
            transform: scale(1.05);
        }
        
        /* é»˜è®¤æ¸å˜èƒŒæ™¯ï¼ˆæ— å›¾æ—¶ä½¿ç”¨ï¼‰ */
        .card-image::before {
            content: '';
            position: absolute;
            inset: 0;
            opacity: 1;
            z-index: 0;
        }
        
        .card-image.has-image {
            background: transparent;
        }
        
        .card-image.has-image::before {
            display: none;
        }
        
        .card-image.shanghai::before { 
            background: linear-gradient(135deg, #e6ddd4 0%, #d4c9bd 50%, #c9b8a8 100%);
        }
        .card-image.world::before { 
            background: linear-gradient(135deg, #d4dde6 0%, #c9d4e0 50%, #a8b5c9 100%);
        }
        .card-image.ai::before { 
            background: linear-gradient(135deg, #e6d4e0 0%, #e0c9d8 50%, #c9a8c2 100%);
        }
        .card-image.stocks::before { 
            background: linear-gradient(135deg, #d4e6d8 0%, #c9e0d0 50%, #a8c9b0 100%);
        }
        .card-image.policy::before { 
            background: linear-gradient(135deg, #e6e0d4 0%, #e0d8c9 50%, #c9c2a8 100%);
        }
        
        /* æ·±è‰²æ¨¡å¼è°ƒæ•´ */
        [data-theme="dark"] .card-image.shanghai::before { 
            background: linear-gradient(135deg, #5a4d42 0%, #4a3d32 50%, #3d2d22 100%);
        }
        [data-theme="dark"] .card-image.world::before { 
            background: linear-gradient(135deg, #3a4a5a 0%, #2a3a4a 50%, #1a2a3a 100%);
        }
        [data-theme="dark"] .card-image.ai::before { 
            background: linear-gradient(135deg, #5a3a52 0%, #4a2a42 50%, #3a1a32 100%);
        }
        [data-theme="dark"] .card-image.stocks::before { 
            background: linear-gradient(135deg, #3a5a42 0%, #2a4a32 50%, #1a3a22 100%);
        }
        [data-theme="dark"] .card-image.policy::before { 
            background: linear-gradient(135deg, #5a523a 0%, #4a422a 50%, #3a321a 100%);
        }
        
        /* å›¾ç‰‡åŠ è½½å¤±è´¥æ—¶çš„éª¨æ¶å± */
        .card-image .skeleton {
            position: absolute;
            inset: 0;
            background: linear-gradient(90deg, var(--bg-primary) 25%, var(--border) 50%, var(--bg-primary) 75%);
            background-size: 200% 100%;
            animation: shimmer 1.5s infinite;
        }
        
        /* AI ç”Ÿæˆæ ‡è¯† */
        .ai-badge {
            position: absolute;
            top: 8px;
            right: 8px;
            padding: 2px 6px;
            background: rgba(0,0,0,0.6);
            color: white;
            font-size: 8px;
            border-radius: 8px;
            z-index: 3;
            backdrop-filter: blur(4px);
        }
        
        @media (min-width: 768px) {
            .ai-badge {
                top: 10px;
                right: 10px;
                padding: 3px 8px;
                font-size: 9px;
                border-radius: 10px;
            }
        }
        
        /* å›¾æ ‡ - æ‰‹æœºç«¯æ›´å° */
        .card-icon {
            position: absolute;
            top: 8px;
            left: 8px;
            width: 28px;
            height: 28px;
            background: rgba(255,255,255,0.95);
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 14px;
            z-index: 2;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            backdrop-filter: blur(10px);
        }
        
        @media (min-width: 768px) {
            .card-icon {
                top: 12px;
                left: 12px;
                width: 36px;
                height: 36px;
                border-radius: 10px;
                font-size: 18px;
            }
        }
        
        [data-theme="dark"] .card-icon {
            background: rgba(45,44,42,0.95);
        }
        
        /* æ ‡ç­¾ - æ‰‹æœºç«¯æ›´å° */
        .card-badge {
            position: absolute;
            top: 8px;
            right: 8px;
            padding: 3px 8px;
            background: rgba(139,115,85,0.9);
            color: white;
            font-size: 9px;
            font-weight: 600;
            border-radius: 12px;
            z-index: 2;
            letter-spacing: 0.3px;
        }
        
        @media (min-width: 768px) {
            .card-badge {
                top: 12px;
                right: 12px;
                padding: 5px 10px;
                font-size: 10px;
                border-radius: 16px;
            }
        }
        
        .category-tag {
            position: absolute;
            bottom: 8px;
            left: 8px;
            padding: 4px 10px;
            background: rgba(255,255,255,0.95);
            color: var(--text-primary);
            font-size: 10px;
            font-weight: 500;
            border-radius: 12px;
            z-index: 2;
            backdrop-filter: blur(10px);
        }
        
        @media (min-width: 768px) {
            .category-tag {
                bottom: 12px;
                left: 12px;
                padding: 5px 12px;
                font-size: 11px;
                border-radius: 16px;
            }
        }
        
        [data-theme="dark"] .category-tag {
            background: rgba(45,44,42,0.95);
            color: var(--text-primary);
        }
        
        /* ç€‘å¸ƒæµ - æ›´ç´§å‡‘ */
        .masonry-grid {
            column-count: 2;
            column-gap: 10px;
            padding: 10px;
        }
        
        @media (min-width: 768px) {
            .masonry-grid {
                column-count: 4;
                column-gap: 14px;
                padding: 14px;
            }
        }
        
        @media (min-width: 1024px) {
            .masonry-grid {
                column-count: 5;
                column-gap: 16px;
                padding: 16px;
            }
        }
        
        .masonry-item {
            break-inside: avoid;
            margin-bottom: 10px;
        }
        
        @media (min-width: 768px) {
            .masonry-item {
                margin-bottom: 14px;
            }
        }
        
        /* æ ‡é¢˜æ ·å¼ - æ‰‹æœºç«¯æ›´å° */
        .card-title {
            font-size: 13px;
            font-weight: 500;
            color: var(--text-primary);
            line-height: 1.5;
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }
        
        @media (min-width: 768px) {
            .card-title {
                font-size: 15px;
                line-height: 1.6;
            }
        }
        
        .card-summary {
            font-size: 11px;
            color: var(--text-secondary);
            line-height: 1.4;
            margin-top: 4px;
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }
        
        @media (min-width: 768px) {
            .card-summary {
                font-size: 13px;
                line-height: 1.5;
                margin-top: 6px;
            }
        }
        
        .card-meta {
            font-size: 10px;
            color: var(--text-tertiary);
            margin-top: 8px;
            display: flex;
            align-items: center;
            gap: 4px;
        }
        
        @media (min-width: 768px) {
            .card-meta {
                font-size: 12px;
                margin-top: 10px;
                gap: 6px;
            }
        }
        
        .card-content {
            padding: 10px;
        }
        
        @media (min-width: 768px) {
            .card-content {
                padding: 14px;
            }
        }
        
        /* é¡¶éƒ¨å¯¼èˆª */
        .header {
            background: var(--bg-secondary);
            padding: 16px 20px;
            position: sticky;
            top: 0;
            z-index: 100;
            border-bottom: 1px solid var(--border);
        }
        
        .category-tabs {
            display: flex;
            gap: 10px;
            overflow-x: auto;
            padding: 4px 0;
            scrollbar-width: none;
        }
        
        .category-tabs::-webkit-scrollbar {
            display: none;
        }
        
        .tab-btn {
            padding: 10px 24px;
            border-radius: 24px;
            font-size: 14px;
            font-weight: 500;
            white-space: nowrap;
            transition: all 0.3s;
            border: none;
            cursor: pointer;
            background: transparent;
            color: var(--text-secondary);
        }
        
        .tab-btn:hover {
            background: var(--bg-primary);
            color: var(--text-primary);
        }
        
        .tab-btn.active {
            background: var(--accent);
            color: white;
        }
        
        /* ä¸»é¢˜åˆ‡æ¢æŒ‰é’® */
        .theme-toggle {
            width: 44px;
            height: 44px;
            border-radius: 14px;
            border: 1px solid var(--border);
            background: var(--bg-card);
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            font-size: 20px;
            transition: all 0.3s;
        }
        
        .theme-toggle:hover {
            transform: scale(1.05);
            background: var(--bg-primary);
        }
        
        /* åŠ è½½åŠ¨ç”» */
        .skeleton {
            background: linear-gradient(90deg, var(--bg-primary) 25%, var(--border) 50%, var(--bg-primary) 75%);
            background-size: 200% 100%;
            animation: shimmer 1.5s infinite;
        }
        
        @keyframes shimmer {
            0% { background-position: -200% 0; }
            100% { background-position: 200% 0; }
        }
        
        /* æ»šåŠ¨æ¡ç¾åŒ– */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }
        
        ::-webkit-scrollbar-track {
            background: var(--bg-primary);
        }
        
        ::-webkit-scrollbar-thumb {
            background: var(--border);
            border-radius: 4px;
        }
        
        ::-webkit-scrollbar-thumb:hover {
            background: var(--text-tertiary);
        }
        
        /* é¢„è§ˆå¼¹çª— */
        .preview-modal {
            position: fixed;
            inset: 0;
            background: rgba(0,0,0,0.6);
            backdrop-filter: blur(8px);
            z-index: 1000;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
        }
        
        .preview-modal.active {
            opacity: 1;
            visibility: visible;
        }
        
        .preview-content {
            background: var(--bg-card);
            border-radius: 24px;
            max-width: 600px;
            width: 100%;
            max-height: 80vh;
            overflow-y: auto;
            position: relative;
            transform: scale(0.9) translateY(20px);
            transition: transform 0.3s ease;
            border: 1px solid var(--border);
        }
        
        .preview-modal.active .preview-content {
            transform: scale(1) translateY(0);
        }
        
        .preview-header {
            position: relative;
            padding: 24px;
            border-bottom: 1px solid var(--border);
        }
        
        .preview-close {
            position: absolute;
            top: 16px;
            right: 16px;
            width: 36px;
            height: 36px;
            border-radius: 50%;
            border: none;
            background: var(--bg-primary);
            color: var(--text-secondary);
            font-size: 20px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s;
        }
        
        .preview-close:hover {
            background: var(--accent);
            color: white;
        }
        
        .preview-body {
            padding: 24px;
        }
        
        .preview-title {
            font-size: 22px;
            font-weight: 600;
            color: var(--text-primary);
            line-height: 1.5;
            margin-bottom: 16px;
        }
        
        .preview-summary {
            font-size: 16px;
            color: var(--text-secondary);
            line-height: 1.8;
            margin-bottom: 24px;
            padding: 20px;
            background: var(--bg-primary);
            border-radius: 16px;
            border-left: 4px solid var(--accent);
        }
        
        .preview-meta {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 24px;
            padding-bottom: 24px;
            border-bottom: 1px solid var(--border);
        }
        
        .preview-tag {
            padding: 6px 14px;
            border-radius: 20px;
            font-size: 13px;
            font-weight: 500;
        }
        
        .preview-time {
            color: var(--text-tertiary);
            font-size: 14px;
        }
        
        .preview-actions {
            display: flex;
            gap: 12px;
        }
        
        .preview-btn {
            flex: 1;
            padding: 14px 24px;
            border-radius: 12px;
            font-size: 15px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s;
            text-align: center;
            text-decoration: none;
        }
        
        .preview-btn-primary {
            background: var(--accent);
            color: white;
            border: none;
        }
        
        .preview-btn-primary:hover {
            background: var(--accent-hover);
        }
        
        .preview-btn-secondary {
            background: var(--bg-primary);
            color: var(--text-secondary);
            border: 1px solid var(--border);
        }
        
        .preview-btn-secondary:hover {
            background: var(--border);
        }
        
        /* å¡ç‰‡æ‘˜è¦é¢„è§ˆ */
        .card-summary-preview {
            font-size: 13px;
            color: var(--text-secondary);
            line-height: 1.6;
            margin-top: 8px;
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
            opacity: 0.8;
        }
    </style>
</head>
<body>
    <!-- Header -->
    <header class="header">
        <div class="flex items-center justify-between mb-4">
            <h1 class="text-xl font-semibold" style="color: var(--text-primary);">æ–°é—»çƒ­ç‚¹</h1>
            <div class="flex items-center gap-3">
                <span id="update-time" class="text-xs" style="color: var(--text-tertiary);"></span>
                <button class="theme-toggle" onclick="toggleTheme()" title="åˆ‡æ¢ä¸»é¢˜">ğŸŒ™</button>
            </div>
        </div>
        
        <div class="category-tabs">
            <button class="tab-btn active" onclick="switchTab('all', this)">å…¨éƒ¨</button>
            <button class="tab-btn" onclick="switchTab('shanghai', this)">ğŸ™ï¸ ä¸Šæµ·</button>
            <button class="tab-btn" onclick="switchTab('world', this)">ğŸŒ å›½é™…</button>
            <button class="tab-btn" onclick="switchTab('ai', this)">ğŸ¤– AI</button>
            <button class="tab-btn" onclick="switchTab('stocks', this)">ğŸ“ˆ ç¾è‚¡</button>
            <button class="tab-btn" onclick="switchTab('policy', this)">ğŸ‡¨ğŸ‡³ æ”¿ç­–</button>
        </div>
    </header>

    <!-- Main Content -->
    <main>
        <div id="news-grid" class="masonry-grid">
            <!-- æ–°é—»å¡ç‰‡å°†åœ¨è¿™é‡Œæ¸²æŸ“ -->
        </div>
        
        <div id="loading" class="text-center py-12" style="color: var(--text-tertiary);">
            <div class="inline-block w-8 h-8 border-2 rounded-full animate-spin" 
                 style="border-color: var(--border); border-top-color: var(--accent);"></div>
            <p class="text-sm mt-3">åŠ è½½ä¸­...</p>
        </div>
    </main>

    <!-- é¢„è§ˆå¼¹çª— -->
    <div id="preview-modal" class="preview-modal" onclick="closePreview(event)">
        <div class="preview-content" onclick="event.stopPropagation()">
            <div class="preview-header">
                <button class="preview-close" onclick="closePreview()">Ã—</button>
                <div id="preview-category" class="preview-tag" style="background: var(--bg-primary); color: var(--text-secondary);"></div>
            </div>
            <div class="preview-body">
                <h2 id="preview-title" class="preview-title"></h2>
                <div class="preview-meta">
                    <span id="preview-source" class="preview-tag" style="background: var(--accent); color: white;"></span>
                    <span id="preview-time" class="preview-time"></span>
                </div>
                <div id="preview-summary" class="preview-summary"></div>
                <div class="preview-actions">
                    <a id="preview-link" href="#" target="_blank" class="preview-btn preview-btn-primary">é˜…è¯»åŸæ–‡ â†’</a>
                    <button class="preview-btn preview-btn-secondary" onclick="closePreview()">å…³é—­</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Pollinations.ai API Key
        const POLLINATIONS_TOKEN = 'pk_AwoOxyA1F7BjqSCq';
        
        let allNews = {};
        let currentTab = 'all';
        
        const categoryConfig = {
            shanghai: { icon: 'ğŸ™ï¸', label: 'ä¸Šæµ·', color: 'shanghai' },
            world: { icon: 'ğŸŒ', label: 'å›½é™…', color: 'world' },
            ai: { icon: 'ğŸ¤–', label: 'AI', color: 'ai' },
            stocks: { icon: 'ğŸ“ˆ', label: 'ç¾è‚¡', color: 'stocks' },
            policy: { icon: 'ğŸ‡¨ğŸ‡³', label: 'æ”¿ç­–', color: 'policy' }
        };
        
        // ä¸»é¢˜åˆ‡æ¢
        function toggleTheme() {
            const html = document.documentElement;
            const currentTheme = html.getAttribute('data-theme');
            const newTheme = currentTheme === 'dark' ? 'light' : 'dark';
            
            html.setAttribute('data-theme', newTheme);
            localStorage.setItem('theme', newTheme);
            
            // æ›´æ–°æŒ‰é’®å›¾æ ‡
            document.querySelector('.theme-toggle').textContent = newTheme === 'dark' ? 'â˜€ï¸' : 'ğŸŒ™';
        }
        
        // åˆå§‹åŒ–ä¸»é¢˜
        function initTheme() {
            const savedTheme = localStorage.getItem('theme');
            const prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
            const theme = savedTheme || (prefersDark ? 'dark' : 'light');
            
            document.documentElement.setAttribute('data-theme', theme);
            document.querySelector('.theme-toggle').textContent = theme === 'dark' ? 'â˜€ï¸' : 'ğŸŒ™';
        }
        
        // åŠ è½½æ–°é—»
        async function loadNews() {
            try {
                const response = await fetch('data.json?t=' + Date.now());
                allNews = await response.json();
                renderNews();
                
                // æ›´æ–°æ—¶é—´
                document.getElementById('update-time').textContent = 
                    new Date().toLocaleString('zh-CN', { 
                        month: '2-digit', day: '2-digit', 
                        hour: '2-digit', minute: '2-digit' 
                    }) + ' æ›´æ–°';
                
                document.getElementById('loading').style.display = 'none';
            } catch (error) {
                console.error('åŠ è½½å¤±è´¥:', error);
                document.getElementById('loading').innerHTML = 
                    '<p style="color: var(--accent);">åŠ è½½å¤±è´¥ï¼Œè¯·åˆ·æ–°é‡è¯•</p>';
            }
        }
        
        // å½“å‰é¢„è§ˆçš„æ–°é—»
        let currentPreviewItem = null;
        let currentItems = []; // ä¿å­˜å½“å‰æ˜¾ç¤ºçš„ itemsï¼Œç¡®ä¿é¢„è§ˆæ—¶ç´¢å¼•ä¸€è‡´
        
        // æ¸²æŸ“æ–°é—»
        function renderNews() {
            const grid = document.getElementById('news-grid');
            grid.innerHTML = '';
            
            currentItems = [];
            
            if (currentTab === 'all') {
                Object.entries(allNews).forEach(([category, news]) => {
                    if (Array.isArray(news)) {
                        news.forEach(item => {
                            currentItems.push({ ...item, category });
                        });
                    }
                });
                currentItems = currentItems.sort(() => Math.random() - 0.5);
            } else {
                currentItems = (allNews[currentTab] || []).map(item => ({ ...item, category: currentTab }));
            }
            
            currentItems = currentItems.slice(0, 50);
            
            grid.innerHTML = currentItems.map((item, index) => createCard(item, index)).join('');
        }
        
        // åˆ›å»ºå¡ç‰‡
        function createCard(item, index) {
            const config = categoryConfig[item.category] || { icon: 'ğŸ“°', label: 'æ–°é—»', color: '' };
            const isNew = item.isNew ? '<span class="card-badge">NEW</span>' : '';
            
            // æ¸…ç†æ ‡é¢˜ä¸­çš„ emoji
            const cleanTitle = item.title.replace(/^[ğŸ ğŸ‘¥ğŸŒ¸ğŸš€âš¡ğŸ”‹ğŸ“ŠğŸ’ŠğŸª™â­â¬†ï¸ğŸ’¬ğŸ‡¨ğŸ‡³]\s*/u, '');
            
            // æ‘˜è¦é¢„è§ˆï¼ˆæ˜¾ç¤ºå‰50å­—ï¼‰
            const summaryPreview = item.summary && item.summary !== config.label 
                ? `<p class="card-summary-preview">${item.summary.substring(0, 50)}${item.summary.length > 50 ? '...' : ''}</p>` 
                : '';
            
            // å¤„ç†å›¾ç‰‡
            let imageHtml = '';
            let hasImageClass = '';
            let aiBadge = '';
            
            if (item.image) {
                // æœ‰å›¾ç‰‡ï¼Œæ˜¾ç¤ºçœŸå®å›¾ç‰‡æˆ–AIç”Ÿæˆå›¾ç‰‡
                hasImageClass = 'has-image';
                aiBadge = item.imageType === 'ai' ? '<span class="ai-badge">ğŸ¨ AI</span>' : '';
                imageHtml = `<img src="${item.image}" alt="${cleanTitle}" loading="lazy" onload="this.style.opacity=1" onerror="this.style.display='none'; this.parentElement.classList.remove('has-image');" style="opacity:0; transition:opacity 0.3s;">`;
            }
            
            return `
                <div class="masonry-item">
                    <div class="xhs-card block" onclick="openPreview(${index})" style="cursor: pointer;">
                        <div class="card-image ${config.color} ${hasImageClass}">
                            ${imageHtml}
                            <div class="card-icon">${config.icon}</div>
                            ${isNew}
                            ${aiBadge}
                            <span class="category-tag">${config.label}</span>
                        </div>
                        <div class="card-content">
                            <h3 class="card-title">${cleanTitle}</h3>
                            ${summaryPreview}
                            <div class="card-meta">
                                <span>${item.source}</span>
                                <span>Â·</span>
                                <span>${item.time || ''}</span>
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }
        
        // æ‰“å¼€é¢„è§ˆå¼¹çª—
        function openPreview(index) {
            // ä½¿ç”¨ currentItems ç¡®ä¿å’Œæ¸²æŸ“æ—¶çš„é¡ºåºä¸€è‡´
            const item = currentItems[index];
            if (!item) return;
            
            currentPreviewItem = item;
            const config = categoryConfig[item.category] || { icon: 'ğŸ“°', label: 'æ–°é—»', color: '' };
            
            // å¡«å……å¼¹çª—å†…å®¹
            document.getElementById('preview-title').textContent = item.title.replace(/^[ğŸ ğŸ‘¥ğŸŒ¸ğŸš€âš¡ğŸ”‹ğŸ“ŠğŸ’ŠğŸª™â­â¬†ï¸ğŸ’¬ğŸ‡¨ğŸ‡³]\s*/u, '');
            document.getElementById('preview-source').textContent = item.source;
            document.getElementById('preview-time').textContent = item.time || '';
            document.getElementById('preview-category').textContent = config.label;
            document.getElementById('preview-link').href = item.link;
            
            // æ‘˜è¦å†…å®¹
            const summaryText = item.summary && item.summary !== config.label 
                ? item.summary 
                : 'æš‚æ— æ‘˜è¦ï¼Œç‚¹å‡»é˜…è¯»åŸæ–‡æŸ¥çœ‹æ›´å¤šè¯¦æƒ…ã€‚';
            document.getElementById('preview-summary').textContent = summaryText;
            
            // æ˜¾ç¤ºå¼¹çª—
            document.getElementById('preview-modal').classList.add('active');
            document.body.style.overflow = 'hidden';
        }
        
        // å…³é—­é¢„è§ˆå¼¹çª—
        function closePreview(event) {
            if (!event || event.target === document.getElementById('preview-modal') || event.target.closest('.preview-close') || event.target.classList.contains('preview-btn-secondary')) {
                document.getElementById('preview-modal').classList.remove('active');
                document.body.style.overflow = '';
                currentPreviewItem = null;
            }
        }
        
        // ESC é”®å…³é—­å¼¹çª—
        document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape') closePreview();
        });
        
        // åˆ‡æ¢æ ‡ç­¾
        function switchTab(tab, btn) {
            currentTab = tab;
            
            document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
            btn.classList.add('active');
            
            renderNews();
        }
        
        // åˆå§‹åŒ–
        initTheme();
        loadNews();
        
        // æ¯5åˆ†é’Ÿåˆ·æ–°
        setInterval(loadNews, 300000);
    </script>
</body>
</html>
